<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>MVC - Hello World</title>
		<link href='http://fonts.googleapis.com/css?family=Inconsolata&subset=latin' rel='stylesheet' type='text/css'>
		<link href='master.css' rel='stylesheet' type='text/css'>
		
	</head>
	<body>
		
		<div class="wrapper">
			<div class="controls">
				<input type="button" name="some_name" value="Add" id="add" />
				<input type="button" name="some_name" value="Subtract" id="subtract" />
			</div>
			
			<div class="count"></div>
		</div>
		
		<script src="http://github.com/documentcloud/underscore/raw/master/underscore.js" type="text/javascript" charset="utf-8"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../src/mvc.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
		
			var my_app = mvc.create(function(exports) {

                var that = this;
				
				this.map.model('count', (function() {
					
					var current_count;
					
					return {
						init: function() {
							current_count = 0;
						},
						
						add: function() {
							current_count++;
							
							this.dispatch('number_changed', [current_count]);
						},
						
						subtract: function() {
							current_count--;
							
							this.dispatch('number_changed', [current_count]);
						}
					}
					
				})());
				
				this.map.view($('.count'), (function() {
					
					return {
						init: function() {
							$(this.element).html('0');
						},
						
						number_changed: function(number) {
							$(this.element).html(number);
						}
					}
					
				})());
				
				this.map.view($('#add'), (function() {
					
					var that;
					
					return {
						dependencies: ['count'],
						
						init: function() {
							that = this;
							
							$(this.element).click(function() {
								that.count.add();
							});
						}
					}
					
				})());
				
				this.map.view($('#subtract'), (function() {
					
					var that;
					
					return {
						dependencies: ['count'],
						
						init: function() {
							that = this;
							
							$(this.element).click(function() {
								that.count.subtract();
							});
						}
					}
					
				})());

                this.map.controller('add', function() {
                    this.count.add();
                }, ['count']);

                exports.add = function() {
                    that.dispatch('add');
                }

                exports.on_add = function(callback) {
                    console.log(that);
                    that.map.controller('add', callback);
                }

            });

            my_app.add();
            
            my_app.on_add(function() {
                console.log('number increased');
            });

		</script>
	</body>
</html>
