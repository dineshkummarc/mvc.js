<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>MVC - Hello World</title>
		
		<script src="../../libs/underscore.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../libs/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../src/mvc.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
	
		<input type="button" name="some_name" value="Add" id="add" />
		
		<div class="count"></div>
		
		<script type="text/javascript" charset="utf-8">
			var my_app = mvc.create(function() {
				
				this.map.singleton('count', (function() {
					
					var current_count;
					
					return {
						init: function() {
							current_count = 0;
						},
						
						add: function() {
							current_count++;
							
							this.dispatch('number_added', [current_count]);
						}
					}
					
				})());
				
				this.map.view($('.count'), (function() {
					
					return {
						init: function() {
							$(this.element).html('No numbers have been entered.');
						},
						
						number_added: function(number) {
							$(this.element).html(number);
						}
					}
					
				})());
				
				this.map.view($('#add'), (function() {
					
					var that;
					
					return {
						dependencies: ['count'],
						
						init: function() {
							that = this;
							
							$(this.element).click(function() {
								that.count.add();
							});
						}
					}
					
				})());
				
				this.map.event('debug', function(msg, value) {
					console.log(msg, value);
				});
				
				this.map.event('number_added', function() {
					this.dispatch('debug', ['Count model: ', this.count]);
				}, ['count']);
				
			});
		</script>
	</body>
</html>