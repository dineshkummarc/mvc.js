<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>MVC - Hello World</title>
		<link href='http://fonts.googleapis.com/css?family=Inconsolata&subset=latin' rel='stylesheet' type='text/css'>
		<link href='master.css' rel='stylesheet' type='text/css'>
		
	</head>
	<body>
		
		<div class="wrapper">
			<div class="controls">
				<input type="button" name="add" value="Add" id="add" />
				<input type="button" name="subtract" value="Subtract" id="subtract" />
				<input type="button" name="reset" value="Reset" id="reset" />
			</div>
			
			<div class="count"></div>
			<div class="events"></div>
		</div>
		
		<script src="http://github.com/documentcloud/underscore/raw/master/underscore.js" type="text/javascript" charset="utf-8"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../src/mvc.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">

            var hello_world = {

                models: {

                    'count': {
                        'facade': (function() {
                            var current_count;

                            return {
                                init: function() {
                                    current_count = 0;
                                },
                                
                                add: function() {
                                    current_count++;
                                    
                                    this.dispatch('number_changed', [current_count]);
                                },
                                
                                subtract: function() {
                                    current_count--;
                                    
                                    this.dispatch('number_changed', [current_count]);
                                },

                                reset: function() {
                                   current_count = 0;

                                   this.dispatch('number_changed', [current_count]);
                                }
                            }
                        })()
                    }

                },

                views: {

                    'display': {
                        element: $('.wrapper .count'),
                        mediator: {
                            init: function() {
                                $(this.element).html('0');
                            },
                            
                            number_changed: function(number) {
                                $(this.element).html(number);
                            }
                        }
                    },

                    'events': {
                        element: $('.wrapper .events'),
                        mediator: {
                            update_action: function(action) {
                                $(this.element).html(action);
                            }
                        }
                    },
                    
                    'add': {
                        element: $('.wrapper #add'),
                        requires: ['count'],
                        mediator: {
                            init: function() {
                                var that = this;
                                
                                $(this.element).click(function() {
                                    that.count.add();
                                });
                            }
                        }
                    },
                    
                    'subtract': {
                        element: $('.wrapper #subtract'),
                        requires: ['count'],
                        mediator: {
                            init: function() {
                                var that = this;
                                
                                $(this.element).click(function() {
                                    that.count.subtract();
                                    that.dispatch('update_action', ['subtract']);
                                });
                            }
                        }
                    },

                    'reset': {
                        element: $('.wrapper #reset'),
                        mediator: {
                            init: function() {
                                var that = this;
                                
                                $(this.element).click(function() {
                                    that.dispatch('reset');
                                });
                            }
                        }
                    }

                },

                controllers: {

                    'reset': {
                        requires: ['count'],
                        command: function() {
                            this.count.reset();
                            this.dispatch('update_action', ['reset']);
                        }
                    }
                
                }
            }
		
            var my_app = mvc(hello_world);
				
		</script>
	</body>
</html>
