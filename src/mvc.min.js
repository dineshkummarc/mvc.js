var mvc=(function(){var a=function(b,c){b.events.init();b.dependencies.init();b.models.init(b.events.dispatch,b.dependencies);b.views.init(b.events,b.dependencies);b.controllers.init(b.events,b.views,b.models,b.dependencies);b.controllers.register("start_up",c);b.events.dispatch("start_up")};return{create:function(c){var b=_.clone(mvc);a(b,c)},events:(function(){var c,b;return{init:function(){b=c={}},listen:function(e,f,d){if(!c[e]){c[e]={callbacks:[],contexts:[]}}c[e].callbacks.push(f);c[e].contexts.push(d||this)},remove:function(f,g){var e=c[f].callbacks,d=_.indexOf(e,g);if(d!==-1){e.splice(d,1)}},removeAll:function(d){c[d]=[]},dispatch:function(g,h){if(c[g]){var f=c[g].callbacks,j=c[g].contexts;if(f){for(var e=0,d=f.length;e<d;e++){f[e].apply(j[e],h)}}}}}})(),models:(function(){var b,c;return{init:function(d,e){b=d;c=e},register:function(e,d){d.dispatch=b;c.register.singleton(e,d,d.dependencies)}}})(),views:(function(){var b,c;return{init:function(e,d){b=e;c=d},register:function(e,d){_.each(e,function(h){var f=_.clone(d),g=_.functions(f);if(f.dependencies){c.inject(f,f.dependencies)}_.each(g,function(i){if(i!=="init"){b.listen(i,f[i],f)}});f.element=h;f.events=b;if(f.init){f.init()}})}}})(),controllers:(function(){var c,e,b,f,d;return{init:function(j,h,g,i){d=this;c=j;e=i;b=h;f=g},register:function(i,j,g){var h={dispatch:c.dispatch,map:{controller:d.register,model:f.register,view:b.register,singleton:e.register.singleton,instance:e.register.instance}};if(g){e.inject(h,g)}c.listen(i,j,h)}}})(),dependencies:(function(){var d,c,b;return{init:function(){b=this;d={};c={}},inject:function(e,f){_.each(f,function(h){if(c[h]){e[h]=c[h];return}else{if(d[h]){var g=_.clone(d[h]);if(typeof g.init==="function"){g.init()}e[h]=g}}})},register:{instance:function(f,e,g){if(g){b.inject(e,g)}d[f]=e},singleton:function(f,e,g){if(!c[f]){if(g){b.inject(e,g)}if(typeof e.init==="function"){e.init()}c[f]=e}}}}})()}})();